 <!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.83">
    <title>o-Maps: маршруты</title>
    <meta name="description" content="Сводная таблица маршрутов СПб и Лен.области">
    <link rel="icon" type="image/png" href="favicon.png"/>
    <link href='./css/google-fonts.css' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/leaflet.css" />
    <link rel="stylesheet" href="css/main.css?v=1"/>
    <link rel="stylesheet" href="css/slideshow.css"/>

    <meta property="og:title" content="o-Maps: таблица маршрутов">
    <meta property="og:site_name" content="Спортивные карты: ориентирование и рогейн">
    <meta property="og:url" content="https://o-maps.spb.ru/">
    <meta property="og:description" content="Сводная таблица маршрутов СПб и Лен.области">
    <meta property="og:image" content="https://o-maps.spb.ru/o-maps-preview-25.jpg">

    <!-- Yandex.Metrika counter -->
    <script type="text/javascript" >
        (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
            m[i].l=1*new Date();
            for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
            k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
        (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

        ym(99914151, "init", {
            clickmap:true,
            trackLinks:true,
            accurateTrackBounce:true
        });
    </script>
    <noscript><div><img src="https://mc.yandex.ru/watch/99914151" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    <!-- /Yandex.Metrika counter -->

    <base target="_blank">
</head>
<body class="stat-body sheet-body sheet-body">
    <a href="tracks.html" target="_self" class="stat-map-link stat-map-link-right" title="Маршруты на карте"><img src="images/map_24.png" alt="Маршруты на карте" /></a>
    <h1>
        <a href="./index.html" target="_self" title="Главная страница">O-maps ◪</a>

        <select class="header_selector" onchange="selectMapRegion(this.value, 'sheet')">
            <option value="index">Начальная страница</option>
            <option disabled>⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯</option>
            <option value="spb">Санкт-Петербург</option>
            <option value="msk">Москва</option>
            <option value="bash">Башкортостан</option>
            <option value="srb">Белград</option>
            <option value="rzn">Рязань</option>
            <option value="smr">Самара</option>
            <option value="all">Все регионы вместе</option>
            <option disabled>⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯</option>
            <option value="docs">Исторические документы</option>
            <option value="tracks" selected>Маршруты</option>
            <option value="calendar">Календарь стартов</option>
        </select>

        <select id="track_type_selector" class="header_selector" onchange="selectTrackType(this.value)">
            <option value="ALL">все типы</option>
            <option value="WALK" class="WALK">Пешая ЭКО-тропа</option>
            <option value="RUN" class="RUN">Бег</option>
            <option value="SKI" class="SKI">Лыжи</option>
            <option value="VELO" class="VELO">Вело</option>
            <option value="WATER" class="WATER">Водный</option>
        </select>

        <select id="track_month_selector" class="header_selector" onchange="selectTrackMonth(this.value)">
            <option value="0">все даты</option>
            <option value="01">Январь</option>
            <option value="02">Февраль</option>
            <option value="03">Март</option>
            <option value="04">Апрель</option>
            <option value="05">Май</option>
            <option value="06">Июнь</option>
            <option value="07">Июль</option>
            <option value="08">Август</option>
            <option value="09">Сентябрь</option>
            <option value="10">Октябрь</option>
            <option value="11">Ноябрь</option>
            <option value="12">Декабрь</option>
        </select>

        <img id="sheet-spinner" src="images/walk-spinner.gif" alt="" />
    </h1>
    <h2 class="text-center">Маршруты Санкт-Петербурга и окрестностей</h2>

    <div class="o-sheet-roof" style="display: none">
        <div>Всего маршрутов - <span id="total_routes"></span>, отдельных треков - <span id="total_tracks"></span>. Из них <span id="run_tracks" class="RUN"></span> беговых, <span id="velo_tracks" class="VELO"></span> вело, <span id="ski_tracks" class="SKI"></span> лыжных, <span id="walk_tracks" class="WALK"></span> пеших и <span id="water_tracks" class="WATER"></span> водных.</div>
        <a href="#" onclick="downloadSheetTable('o-maps-tracks.csv')" target="_self" title="Скачать таблицу"><img src="images/download_24.png" /></a>
    </div>
    <div class="o-sheet-wrapper">
        <table class="o-main-table o-sheet tracks-table">
            <thead>
            <tr>
                <th>&nbsp</th>
                <th>Название</th>
                <th>Дата</th>
                <th>Инфо</th>
                <th>Длина</th>
                <th>GPX</th>
                <th>Маркир</th>
                <th>Ссылки</th>
                <th>Тип</th>
                <th>Фотки</th>
            </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <!-- Модальное окно -->
    <div id="slideshow-modal" class="modal">
        <span class="close">&times;</span>

        <div class="modal-content">
            <!-- Слайды будут добавляться здесь -->
        </div>

        <a class="prev">&#10094;</a>
        <a class="next">&#10095;</a>
    </div>

    <script src="js/ext/jquery.slim.min.js"></script>
    <script src="js/ext/leaflet.js"></script>
    <script src="js/ext/GPX.js"></script>

    <script src="js/utils-common.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/welcome.js"></script>
    <script src="js/starts.js"></script>
    <script src="js/tracks-run.js"></script>
    <script src="js/tracks-ski.js"></script>
    <script src="js/tracks.js"></script>

    <script>
        let urlParams = new URLSearchParams(window.location.search);
        const TRACK_TYPE_PARAM = urlParams.get('track-type');
        if (TRACK_TYPE_PARAM) {
            let selector = document.getElementById('track_type_selector');
            selector.value = TRACK_TYPE_PARAM;
        }

        const TRACK_MONTH_PARAM = urlParams.get('track-month');
        if (TRACK_MONTH_PARAM) {
            let selector = document.getElementById('track_month_selector');
            selector.value = TRACK_MONTH_PARAM;
        }

        // Массив с адресами картинок
        const images = [];
        let picCounter = 0;

        let totalRoutes = 0;
        let totalTracks = 0;
        let wlkTracks = 0;
        let rTracks = 0;
        let vTracks = 0;
        let sTracks = 0;
        let wtrTracks = 0;

        let oTracks = [
            ...runTracks,
            ...skiTracks,
            ...tracks,
        ];

        window.onload = function() {

            oTracks.sort((a, b) => (a.name || '').localeCompare(b.name || ''));

            // Изначальный рендеринг таблицы
            renderTracksTable();
        }

        // Ссылка на тело таблицы
        const tbody = document.querySelector('.o-main-table tbody');

        // строит табличку с инфой об авторах-составителях
        function renderTracksTable() {
            tbody.innerHTML = '';

            let counter = 1;
            for (let i = 0; i < oTracks.length; i++) {
                let t = oTracks[i];

                if (TRACK_TYPE_PARAM && (!t.type || !t.type.includes(TRACK_TYPE_PARAM))) {
                    continue;
                }
                if (TRACK_MONTH_PARAM && (!t.date || (new Date(t.date).getMonth() !== (TRACK_MONTH_PARAM - 1)))) {
                    continue;
                }

                const row = document.createElement('tr');
                td(t, row, counter++);
                td(t, row, buildName(t));
                td(t, row, buildDate(t));
                td(t, row, buildInfo(t));
                td(t, row, buildLength(t));
                td(t, row, buildTrackDownloadLinks(t));
                td(t, row, buildMarkir(t));
                td(t, row, buildLinks(t));
                td(t, row, getTypesList(t, true));
                td(t, row, buildFotos(t));
                tbody.appendChild(row);

                let kTracks = countEntries(t.gpx);
                totalRoutes++;
                totalTracks += kTracks;
                if (t.type) {
                    if (t.type.includes('WALK')) {
                        wlkTracks += kTracks;
                    }
                    if (t.type.includes('RUN')) {
                        rTracks += kTracks;
                    }
                    if (t.type.includes('VELO')) {
                        vTracks += kTracks;
                    }
                    if (t.type.includes('SKI')) {
                        sTracks += kTracks;
                    }
                    if (t.type.includes('WATER')) {
                        wtrTracks += kTracks;
                    }
                }
            }
            document.body.style.cursor = 'default';

            document.getElementById('total_routes').innerText = totalRoutes;
            document.getElementById('total_tracks').innerText = totalTracks;
            document.getElementById('run_tracks').innerText = rTracks;
            document.getElementById('walk_tracks').innerText = wlkTracks;
            document.getElementById('velo_tracks').innerText = vTracks;
            document.getElementById('ski_tracks').innerText = sTracks;
            document.getElementById('water_tracks').innerText = wtrTracks;

            document.getElementById('sheet-spinner').style.display = 'none';
            document.querySelector('.o-sheet-roof').style.display = 'block';
        }

        function td(m, row, html) {
            const td = document.createElement('td');
            td.innerHTML = html;
            row.appendChild(td);
        }

        function buildName(t) {
            let result = '';
            result += '<b><a href="' + trackLink(getFirstTrack(t), true) + '">' + t.name + '<a/></b>';
            return result;
        }

        function buildDate(t) {
            let y = year(t);
            if (y) {
                return t.date ? formatDate(t, true, false) : t.year;
            } else {
                return '';
            }
        }

        function buildInfo(t) {
            let result = '';
            if (t.start) {
                result += '<b>' + getMapStarts(t) + '</b> ';
            }
            if (t.info) {
                result += t.info;
            }
            if (t.results) {
                result += '<a href="' + t.results + '"> Результаты</a>';
            }
            return result;
        }

        function buildLength(t) {
            let l = calculateTrackLength(t);
            if ('0м' === l) {
                return '';
            } else {
                return l;
            }
        }

        function buildMarkir(t) {
            let result = '';
            if (t.markir) {
                result += '<img src="./images/favorite.png" title="Маркированный маршрут" />';
            }
            return result;
        }

        function buildLinks(t) {
            let result = '';
            if (t.link) {
                result += '<a href="' + t.link + '" title="' + t.name + '" class="ext-link"><img src="./images/url-file.png" /></a>';
            }
            return result;
        }

        function buildFotos(t) {
            let result = '';
            if (t.pics) {
                for (let p = 1; p <= t.pics[1]; p++) {
                    let url = 'tracks/' + t.pics[0] + '/pic_' + p + '.jpg';
                    result += '<a href="#" onClick="openModal(' + picCounter++ + '); return false;"><img src="' + url + '" class="track-table-pic" /></a>';
                    images.push(url);
                }
            }
            return result;
        }

        writeWelcomeButton();
    </script>
    <script src="js/slideshow.js"></script>
</body>
</html>
